# Rime schema
# encoding: utf-8
# https://github.com/u1805/rime

schema:
  schema_id: flypy_flypy
  name: å°é¹¤åŒæ‹¼
  version: "2024-07-24"
  author:
    - Functoreality
    - Dvel
    - gaboolic ï¼ˆè£ç¼)
    - Modified by dai0v0
  description: |
    å°é¹¤åŒæ‹¼+è¾…åŠ©ç  https://github.com/gaboolic/rime-shuangpin-fuzhuma
    ç¨å¾®çš„æ”¹äº†ä¸€ä¸‹ï¼ˆå°å£°
  dependencies:
    - stroke
    - radical_flypy
    - emoji
    - melt_eng
    - japanese
    - pinyin_simp

switches:
  - name: ascii_mode
    states: [ æ–‡, A ]
  - name: full_shape
    states: [ $, ï¿¥ ]
  - name: traditionalization
    states: [ ç®€, ç¹ ]
  - name: emoji
    reset: 0 # é»˜è®¤çŠ¶æ€: 0 å…³é—­ 1 å¼€å¯
    states: [ ğŸ’€, ğŸ˜„ ]
  - name: mars
    reset: 0
    states: [ åœ°, ç…‹ ] #ç«æ˜Ÿæ–‡
  - name: others
    reset: 1
  # - name: ascii_punct
  #   states: [ ã€‚ï¼Œ, ï¼ï¼Œ ]

engine:
  processors:
    - lua_processor@*key_binder # ç»‘å®šæŒ‰é”®match
    - lua_processor@*xhup/shortcut_processor
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - affix_segmentor@emojis
    - affix_segmentor@pinyin
    - affix_segmentor@melt_eng
    - affix_segmentor@japanese
    - fallback_segmentor
  translators:
    - punct_translator
    - table_translator@my_custom_phrase
    - table_translator@melt_eng_in_cn
    - table_translator@custom_phrase
    - table_translator@custom_phrase_kf
    - table_translator@custom_phrase_xhzg
    - table_translator@custom_phrase_super_1jian
    - table_translator@custom_phrase_super_2jian
    - table_translator@custom_phrase_super_3jian
    - table_translator@custom_phrase_super_3jian_no_conflict
    - table_translator@custom_phrase_super_4jian_no_conflict
    - reverse_lookup_translator
    - reverse_lookup_translator@reverse_stroke
    - script_translator
    - script_translator@pinyin
    - script_translator@emojis           # æ·»åŠ æ³¨é‡Šåï¼šåœç”¨aeæ¨¡å¼emojiè¾“å…¥
    - script_translator@melt_eng         # æ·»åŠ æ³¨é‡Šåï¼šåœç”¨å•è¯è¾“å…¥
    - script_translator@japanese         # æ·»åŠ æ³¨é‡Šåï¼šåœç”¨æ—¥è¯­è¾“å…¥
    - lua_translator@*melt
    - lua_translator@*date_translator    # æ—¶é—´ã€æ—¥æœŸã€æ˜ŸæœŸ
    - lua_translator@*lunar              # å†œå†
    - lua_translator@*unicode            # Unicode
    - lua_translator@*number_translator  # æ•°å­—ã€é‡‘é¢å¤§å†™
    - lua_translator@*calculator         # è®¡ç®—å™¨
    - lua_translator@*xhup/shortcut_translator  # Lua ç›´é€šè½¦
  filters:
    - lua_filter@*laneChangeAndSpace_Filter  # æŠŠ<br>æ›¿æ¢ä¸ºæ¢è¡Œ
    - lua_filter@*is_in_user_dict            # ç”¨æˆ·è¯å…¸çš„è¯åŠ ä¸Šä¸€ä¸ª*
    - lua_filter@*stick                      # tabç½®é¡¶è¯å›æ˜¾åœ¨ç¬¬ä¸€ä¸ªcommentä¸­
    - lua_filter@*long_word_filter           # é•¿è¯ä¼˜å…ˆï¼ˆé¡ºåºè¦æ±‚ï¼šé•¿è¯ä¼˜å…ˆ > Emojiï¼‰
    - lua_filter@*autocap_filter             # è‹±æ–‡è‡ªåŠ¨å¤§å†™
    - simplifier@emoji                       # Emoji
    - lua_filter@*reduce_emoji_filter        # æŒ‰éœ€å¯ç”¨ï¼Œä½œç”¨æ˜¯é™ä½Emojiåœ¨å€™é€‰é¡¹ä¸­çš„ä½ç½®æ’åº(é¡ºåºè¦æ±‚ï¼šEmoji > é™ä½æ’åº)
    - simplifier@chinese_english             # ä¸­è‹±è¯å…¸
    - simplifier@traditionalize              # ç®€ç¹åˆ‡æ¢
    - simplifier@mars                        # ç«æ˜Ÿæ–‡
    - simplifier@others                      # æœˆä»½æ˜ŸæœŸ/ç¬¦å·/éƒ¨é¦–/äººå/ç”Ÿåƒ»å­—...
    - uniquifier

# Lua é…ç½®: æ—¥æœŸã€æ—¶é—´ã€æ˜ŸæœŸã€ISO 8601ã€æ—¶é—´æˆ³çš„è§¦å‘å…³é”®å­—
date_translator:
  date: date            # æ—¥æœŸï¼š 2022-11-29
  time: time            # æ—¶é—´ï¼š 18:13
  week: week            # æ˜ŸæœŸï¼š æ˜ŸæœŸäºŒ
  datetime: datetime    # ISO 8601ï¼š 2022-11-29T18:13:11+08:00
  timestamp: timestamp  # æ—¶é—´æˆ³ï¼š 1669716794
  month: month          # æœˆä»½ï¼š June/Jun

melt:
  uuid: uuid

# Lua é…ç½®ï¼šå†œå†çš„è§¦å‘å…³é”®å­—
lunar: lunar  # å†œå†ï¼š äºŒã€‡äºŒä¸‰å¹´å†¬æœˆäºŒå ç™¸å¯å¹´ï¼ˆå…”ï¼‰å†¬æœˆäºŒå
# Lua é…ç½®ï¼šé•¿è¯ä¼˜å…ˆ
# æå‡ count ä¸ªè¯è¯­ï¼Œæ’å…¥åˆ°ç¬¬ idx ä¸ªä½ç½®ã€‚
# ç¤ºä¾‹ï¼šå°† 2 ä¸ªè¯æ’å…¥åˆ°ç¬¬ 1  ä¸ªå€™é€‰é¡¹ï¼Œè¾“å…¥ æ€»ç®— å¾—åˆ°ã€Œ1æ€»ç®— 2çºµã€
long_word_filter:
  count: 2
  idx: 1

speller:
  # å¦‚æœä¸æƒ³è®©ä»€ä¹ˆæ ‡ç‚¹ç›´æ¥ä¸Šå±ï¼Œå¯ä»¥åŠ åœ¨ alphabetï¼Œæˆ–è€…ç¼–è¾‘æ ‡ç‚¹ç¬¦å·ä¸ºä¸¤ä¸ªåŠä»¥ä¸Šçš„æ˜ å°„
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA/`;
  # initials å®šä¹‰ä»…ä½œä¸ºå§‹ç çš„æŒ‰é”®ï¼Œæ’é™¤ ` è®©å•ä¸ªçš„ ` å¯ä»¥ç›´æ¥ä¸Šå±
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA/
  # ç¬¬ä¸€ä½<ç©ºæ ¼>æ˜¯æ‹¼éŸ³ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼›ç¬¬äºŒä½<'>è¡¨ç¤ºå¯ä»¥æ‰‹åŠ¨è¾“å…¥å•å¼•å·æ¥åˆ†å‰²æ‹¼éŸ³ã€‚
  delimiter: " '"
  algebra:
    # æ—¥è¯­é•¿éŸ³ä¿ƒéŸ³è§„åˆ™
    - 'derive/_/x/'
    - 'derive/-/q/'
  
    - derive/^(\w\w);(\w)(\w)$/$1$2`/  # ABC`
    - derive/^(\w\w);(\w)(\w)$/$1`$3/  # AB`D
    - derive/^(\w\w);(\w)(\w)$/$1``/   # AB``
    # - derive/^(\w\w);(\w)(\w)$/``$2$3/  # ``CD
    
    # æ¨¡ç³ŠéŸ³ å¯é€‰æ‹©æ€§å¼€å¯
    # - derive/^z([a-z])/v$1/
    # - derive/^c([a-z])/i$1/
    # - derive/^s([a-z])/u$1/
    # - derive/^v([a-z])/z$1/
    # - derive/^i([a-z])/c$1/
    # - derive/^u([a-z])/s$1/

    - derive/^(..)[;].+$/$1/
    - derive/^(..[;].).+$/$1/
    # - derive/^([jqxy])u/$1v/
    - derive/[;]//

translator:
  dictionary: flypy_flypy
  enable_completion: false
  ##  é»˜è®¤ä¸ºä¸è¶…è¿‡ 2 ä¸ªå­—çš„å€™é€‰é¡¹æ˜¾ç¤ºè¾“å…¥ç ï¼›å°† 2 æ”¹ä¸º 0 å¯å…³é—­ç¼–ç æç¤ºï¼Œ
  ##  æ”¹ä¸º 1 åˆ™æ˜¯åªæ˜¾ç¤ºå•å­—çš„è¾“å…¥ç ï¼Œä¾æ­¤ç±»æ¨ã€‚
  spelling_hints: 1
  comment_format:
    - "xform/(^|[ '])[^;]+[;]/$1/" ## ç¼–ç æç¤ºåªæ˜¾ç¤ºè¾…åŠ©ç éƒ¨åˆ†

  enable_user_dict: true # æ˜¯å¦å¼€å¯è‡ªåŠ¨è°ƒé¢‘
  initial_quality: 1.2  # æ‹¼éŸ³æƒé‡ 1.2

# è‡ªå®šä¹‰è¯åº“
my_custom_phrase:
  dictionary: ""
  user_dict: custom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: true
  initial_quality: 1

melt_eng_in_cn:
  dictionary: melt_eng
  enable_sentence: false   # ç¦æ­¢é€ å¥
  enable_user_dict: false  # ç¦ç”¨ç”¨æˆ·è¯å…¸
  initial_quality: 1.1     # è‹±æ–‡æƒé‡ 1.1
  comment_format:          # è‡ªå®šä¹‰æç¤ºç 
    - xform/.*//           # æ¸…ç©ºæç¤ºç ï¼ˆå°±æ˜¯æ²¡æœ‰é‚£ä¸ªå°å°¾å·´ï¼‰

grammar:
  language: zh-hans-t-essay-bgw

reverse_lookup:
  dictionary: radical_flypy # https://github.com/mirtlecn/rime-radical-pinyin
  enable_completion: true
  prefix: "az"
  suffix: "'"
  tips: ã€”éƒ¨ä»¶ç»„å­—ã€•
  preedit_format:
    # - xlit/hspnz/ä¸€ä¸¨ä¸¿ä¸¶ä¹™/

reverse_stroke:
  tag: reverse_stroke
  dictionary: stroke # stroke
  enable_completion: true
  prefix: "ab"
  suffix: "'"
  tips: ã€”ç¬”ç”»hspnzã€• # ã€”ç­†ç•«ã€•
  preedit_format:
    - xlit/hspnz/ä¸€ä¸¨ä¸¿ä¸¶ä¹™/

# Emoji
emoji:
  option_name: emoji
  opencc_config: emoji.json
  inherit_comment: false  # åœ¨ corrector.lua åŠåæŸ¥ä¸­ï¼Œemoji è¿”å›ç©ºæ³¨é‡Š

# ç®€ç¹åˆ‡æ¢
traditionalize:
  option_name: traditionalization
  opencc_config: s2tw.json  # s2t.json | s2hk.json | s2tw.json | s2twp.json
  tips: char               # è½¬æ¢æç¤º: all éƒ½æ˜¾ç¤º | char ä»…å•å­—æ˜¾ç¤º | none ä¸æ˜¾ç¤ºã€‚
  tags: [ abc, number, gregorian_to_lunar ]  # é™åˆ¶åœ¨å¯¹åº” tagï¼Œä¸å¯¹å…¶ä»–å¦‚åæŸ¥çš„å†…å®¹åšç®€ç¹è½¬æ¢# ç«æ˜Ÿæ–‡åˆ‡æ¢

# ç«æ˜Ÿæ–‡åˆ‡æ¢
mars:
  opencc_config: martian.json 
  option_name: mars

#ä¸­æ–‡è½¬è‹±æ–‡
chinese_english:
  option_name: chinese_english
  opencc_config: chinese_english.json
  tips: char
  comment_format:
    - "xform/-/ /"

# Ohters
others:
  option_name: others
  opencc_config: others.json

# æ ‡ç‚¹ç¬¦å·
punctuator:
  import_preset: symbols

# æŒ‰é”®ç»‘å®š
key_binder:
  import_preset: default
  bindings:
    - { when: always, accept: Control+1, toggle: emoji }              # åˆ‡æ¢æ˜¯å¦æ˜¾ç¤º Emoji
    - { when: always, accept: Control+2, toggle: traditionalization } # åˆ‡æ¢ç®€ç¹
    - { when: always, accept: Control+3, toggle: chinese_english }    # ä¸­è‹±äº’è¯‘
    # - { when: has_menu, accept: semicolon, send: 2 }
    # - { when: has_menu, accept: slash, send: 3 }
    - { match: "[a-z]{1,3}", accept: Tab,  send_sequence: "/1" }      # ç®€æ‹¼

recognizer:
  # import_preset: default
  patterns:
    punct: "^/([0-9]0?|[A-Za-z]+)$" # å“åº” symbols.yaml å†…çš„è¾“å…¥
    ## æ‹†å­—ã€ç¬”ç”»:
    reverse_lookup: "^az[a-z]*'?$" # "[[]b[a-z]*'?$"
    reverse_stroke: "^ab[A-Za-z]*$"
    ## ä¸´æ—¶è¾“å…¥
    emojis: "^ae[a-z]*'?$"
    melt_eng: "^aw[A-Za-z]*"
    japanese: "^aj[a-z]*"
    pinyin: "^ap[a-z]*'?$"
    ## åŠŸèƒ½
    calculator: "^V.*$"                 # è®¡ç®—å™¨éœ€è¦ç”¨
    unicode: "^U[a-f0-9]+"              # è„šæœ¬å°†è‡ªåŠ¨è·å–ç¬¬ 2 ä¸ªå­—ç¬¦ U ä½œä¸ºè§¦å‘å‰ç¼€ï¼Œå“åº” lua_translator@unicodeï¼Œè¾“å‡º Unicode å­—ç¬¦
    number: "^R[0-9]+[.]?[0-9]*"        # è„šæœ¬å°†è‡ªåŠ¨è·å–ç¬¬ 2 ä¸ªå­—ç¬¦ R ä½œä¸ºè§¦å‘å‰ç¼€ï¼Œå“åº” lua_translator@number_translatorï¼Œæ•°å­—é‡‘é¢å¤§å†™
    gregorian_to_lunar: "^N[0-9]{1,8}"  # è„šæœ¬å°†è‡ªåŠ¨è·å–ç¬¬ 2 ä¸ªå­—ç¬¦ N ä½œä¸ºè§¦å‘å‰ç¼€ï¼Œå“åº” lua_translator@lunarï¼Œå…¬å†è½¬å†œå†ï¼Œè¾“å…¥ N20240115 å¾—åˆ°ã€ŒäºŒã€‡äºŒä¸‰å¹´è…Šæœˆåˆäº”ã€

################################## åŠŸèƒ½è¯å…¸ #############################
emojis:
  tag: emojis
  dictionary: emoji
  enable_completion: true
  prefix: "ae"
  suffix: "'"
  tips: "ã€”Emojiã€•"

melt_eng:
  tag: melt_eng
  dictionary: melt_eng
  enable_completion: true
  enable_sentence: false
  prefix: "aw"
  # suffix: "'"
  tips: "ã€”è‹±æ–‡ã€•"
  spelling_hints: 5
  comment_format:
    - xform/^.+$//

japanese:
  tag: japanese
  dictionary: japanese
  enable_completion: false
  enable_sentence: true
  prefix: "aj"
  # suffix: "'"
  tips: "ã€”æ—¥æ–‡ã€•"
  spelling_hints: 5
  comment_format:
    - xform/^.+$//

pinyin:
  tag: pinyin
  prism: pinyin_simp
  dictionary: pinyin_simp 
  enable_completion: false
  enable_sentence: true
  prefix: "ap"
  suffix: "'"
  tips: "ã€”å…¨æ‹¼ã€•"

################################## ç®€ç è¯å…¸ #############################
# å°é¹¤ç®€ç 
custom_phrase:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 1

# å°é¹¤å¿«ç¬¦
custom_phrase_kf:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_kf
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: -1 #æœ¬è¡¨è¯å’Œç³»ç»Ÿè¯é‡ç å±…å

# å°é¹¤å­—æ ¹
custom_phrase_xhzg:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_xhzg
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: -1 #æœ¬è¡¨è¯å’Œç³»ç»Ÿè¯é‡ç å±…å

# è¶…å¼ºtab 1ç 
custom_phrase_super_1jian:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_super_1jian
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: -1 #æœ¬è¡¨è¯å’Œç³»ç»Ÿè¯é‡ç å±…å

# è¶…å¼ºtab 2ç 
custom_phrase_super_2jian:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_super_2jian
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: -1 #æœ¬è¡¨è¯å’Œç³»ç»Ÿè¯é‡ç å±…å

# è¶…å¼ºtab 3ç 
custom_phrase_super_3jian:
  dictionary: ""
  user_dict: custom_phrase/custom_phrase_super_3jian
  db_class: stabledb
  enable_sentence: false
  enable_completion: false
  initial_quality: -1 #æœ¬è¡¨è¯å’Œç³»ç»Ÿè¯é‡ç å±…å